// 此文件由 scripts/build-worker.ts 自动生成，请勿手动编辑
// 运行 pnpm build:worker 重新生成

export const BOUNDARY_WORKER_CODE = "\nself.onerror = function(message, source, lineno, colno, error) {\n  self.postMessage({ id: -1, error: 'Worker global error: ' + message });\n  return true;\n};\n\ntry {\n\"use strict\";(()=>{function G(t){\"@babel/helpers - typeof\";return G=typeof Symbol==\"function\"&&typeof Symbol.iterator==\"symbol\"?function(e){return typeof e}:function(e){return e&&typeof Symbol==\"function\"&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},G(t)}var J=/^\\s+/,K=/\\s+$/;function o(t,e){if(t=t||\"\",e=e||{},t instanceof o)return t;if(!(this instanceof o))return new o(t,e);var r=Q(t);this._originalInput=t,this._r=r.r,this._g=r.g,this._b=r.b,this._a=r.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||r.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=r.ok}o.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),r,n,s,a,i,f;return r=e.r/255,n=e.g/255,s=e.b/255,r<=.03928?a=r/12.92:a=Math.pow((r+.055)/1.055,2.4),n<=.03928?i=n/12.92:i=Math.pow((n+.055)/1.055,2.4),s<=.03928?f=s/12.92:f=Math.pow((s+.055)/1.055,2.4),.2126*a+.7152*i+.0722*f},setAlpha:function(e){return this._a=V(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=E(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=E(this._r,this._g,this._b),r=Math.round(e.h*360),n=Math.round(e.s*100),s=Math.round(e.v*100);return this._a==1?\"hsv(\"+r+\", \"+n+\"%, \"+s+\"%)\":\"hsva(\"+r+\", \"+n+\"%, \"+s+\"%, \"+this._roundA+\")\"},toHsl:function(){var e=$(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=$(this._r,this._g,this._b),r=Math.round(e.h*360),n=Math.round(e.s*100),s=Math.round(e.l*100);return this._a==1?\"hsl(\"+r+\", \"+n+\"%, \"+s+\"%)\":\"hsla(\"+r+\", \"+n+\"%, \"+s+\"%, \"+this._roundA+\")\"},toHex:function(e){return N(this._r,this._g,this._b,e)},toHexString:function(e){return\"#\"+this.toHex(e)},toHex8:function(e){return nt(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return\"#\"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?\"rgb(\"+Math.round(this._r)+\", \"+Math.round(this._g)+\", \"+Math.round(this._b)+\")\":\"rgba(\"+Math.round(this._r)+\", \"+Math.round(this._g)+\", \"+Math.round(this._b)+\", \"+this._roundA+\")\"},toPercentageRgb:function(){return{r:Math.round(v(this._r,255)*100)+\"%\",g:Math.round(v(this._g,255)*100)+\"%\",b:Math.round(v(this._b,255)*100)+\"%\",a:this._a}},toPercentageRgbString:function(){return this._a==1?\"rgb(\"+Math.round(v(this._r,255)*100)+\"%, \"+Math.round(v(this._g,255)*100)+\"%, \"+Math.round(v(this._b,255)*100)+\"%)\":\"rgba(\"+Math.round(v(this._r,255)*100)+\"%, \"+Math.round(v(this._g,255)*100)+\"%, \"+Math.round(v(this._b,255)*100)+\"%, \"+this._roundA+\")\"},toName:function(){return this._a===0?\"transparent\":this._a<1?!1:dt[N(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var r=\"#\"+q(this._r,this._g,this._b,this._a),n=r,s=this._gradientType?\"GradientType = 1, \":\"\";if(e){var a=o(e);n=\"#\"+q(a._r,a._g,a._b,a._a)}return\"progid:DXImageTransform.Microsoft.gradient(\"+s+\"startColorstr=\"+r+\",endColorstr=\"+n+\")\"},toString:function(e){var r=!!e;e=e||this._format;var n=!1,s=this._a<1&&this._a>=0,a=!r&&s&&(e===\"hex\"||e===\"hex6\"||e===\"hex3\"||e===\"hex4\"||e===\"hex8\"||e===\"name\");return a?e===\"name\"&&this._a===0?this.toName():this.toRgbString():(e===\"rgb\"&&(n=this.toRgbString()),e===\"prgb\"&&(n=this.toPercentageRgbString()),(e===\"hex\"||e===\"hex6\")&&(n=this.toHexString()),e===\"hex3\"&&(n=this.toHexString(!0)),e===\"hex4\"&&(n=this.toHex8String(!0)),e===\"hex8\"&&(n=this.toHex8String()),e===\"name\"&&(n=this.toName()),e===\"hsl\"&&(n=this.toHslString()),e===\"hsv\"&&(n=this.toHsvString()),n||this.toHexString())},clone:function(){return o(this.toString())},_applyModification:function(e,r){var n=e.apply(null,[this].concat([].slice.call(r)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(ot,arguments)},brighten:function(){return this._applyModification(ut,arguments)},darken:function(){return this._applyModification(ft,arguments)},desaturate:function(){return this._applyModification(at,arguments)},saturate:function(){return this._applyModification(st,arguments)},greyscale:function(){return this._applyModification(it,arguments)},spin:function(){return this._applyModification(ht,arguments)},_applyCombination:function(e,r){return e.apply(null,[this].concat([].slice.call(r)))},analogous:function(){return this._applyCombination(gt,arguments)},complement:function(){return this._applyCombination(lt,arguments)},monochromatic:function(){return this._applyCombination(bt,arguments)},splitcomplement:function(){return this._applyCombination(ct,arguments)},triad:function(){return this._applyCombination(D,[3])},tetrad:function(){return this._applyCombination(D,[4])}};o.fromRatio=function(t,e){if(G(t)==\"object\"){var r={};for(var n in t)t.hasOwnProperty(n)&&(n===\"a\"?r[n]=t[n]:r[n]=F(t[n]));t=r}return o(t,e)};function Q(t){var e={r:0,g:0,b:0},r=1,n=null,s=null,a=null,i=!1,f=!1;return typeof t==\"string\"&&(t=yt(t)),G(t)==\"object\"&&(w(t.r)&&w(t.g)&&w(t.b)?(e=tt(t.r,t.g,t.b),i=!0,f=String(t.r).substr(-1)===\"%\"?\"prgb\":\"rgb\"):w(t.h)&&w(t.s)&&w(t.v)?(n=F(t.s),s=F(t.v),e=rt(t.h,n,s),i=!0,f=\"hsv\"):w(t.h)&&w(t.s)&&w(t.l)&&(n=F(t.s),a=F(t.l),e=et(t.h,n,a),i=!0,f=\"hsl\"),t.hasOwnProperty(\"a\")&&(r=t.a)),r=V(r),{ok:i,format:t.format||f,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:r}}function tt(t,e,r){return{r:v(t,255)*255,g:v(e,255)*255,b:v(r,255)*255}}function $(t,e,r){t=v(t,255),e=v(e,255),r=v(r,255);var n=Math.max(t,e,r),s=Math.min(t,e,r),a,i,f=(n+s)/2;if(n==s)a=i=0;else{var h=n-s;switch(i=f>.5?h/(2-n-s):h/(n+s),n){case t:a=(e-r)/h+(e<r?6:0);break;case e:a=(r-t)/h+2;break;case r:a=(t-e)/h+4;break}a/=6}return{h:a,s:i,l:f}}function et(t,e,r){var n,s,a;t=v(t,360),e=v(e,100),r=v(r,100);function i(m,S,_){return _<0&&(_+=1),_>1&&(_-=1),_<1/6?m+(S-m)*6*_:_<1/2?S:_<2/3?m+(S-m)*(2/3-_)*6:m}if(e===0)n=s=a=r;else{var f=r<.5?r*(1+e):r+e-r*e,h=2*r-f;n=i(h,f,t+1/3),s=i(h,f,t),a=i(h,f,t-1/3)}return{r:n*255,g:s*255,b:a*255}}function E(t,e,r){t=v(t,255),e=v(e,255),r=v(r,255);var n=Math.max(t,e,r),s=Math.min(t,e,r),a,i,f=n,h=n-s;if(i=n===0?0:h/n,n==s)a=0;else{switch(n){case t:a=(e-r)/h+(e<r?6:0);break;case e:a=(r-t)/h+2;break;case r:a=(t-e)/h+4;break}a/=6}return{h:a,s:i,v:f}}function rt(t,e,r){t=v(t,360)*6,e=v(e,100),r=v(r,100);var n=Math.floor(t),s=t-n,a=r*(1-e),i=r*(1-s*e),f=r*(1-(1-s)*e),h=n%6,m=[r,i,a,a,f,r][h],S=[f,r,r,i,a,a][h],_=[a,a,f,r,r,i][h];return{r:m*255,g:S*255,b:_*255}}function N(t,e,r,n){var s=[k(Math.round(t).toString(16)),k(Math.round(e).toString(16)),k(Math.round(r).toString(16))];return n&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join(\"\")}function nt(t,e,r,n,s){var a=[k(Math.round(t).toString(16)),k(Math.round(e).toString(16)),k(Math.round(r).toString(16)),k(j(n))];return s&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)&&a[3].charAt(0)==a[3].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join(\"\")}function q(t,e,r,n){var s=[k(j(n)),k(Math.round(t).toString(16)),k(Math.round(e).toString(16)),k(Math.round(r).toString(16))];return s.join(\"\")}o.equals=function(t,e){return!t||!e?!1:o(t).toRgbString()==o(e).toRgbString()};o.random=function(){return o.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function at(t,e){e=e===0?0:e||10;var r=o(t).toHsl();return r.s-=e/100,r.s=Y(r.s),o(r)}function st(t,e){e=e===0?0:e||10;var r=o(t).toHsl();return r.s+=e/100,r.s=Y(r.s),o(r)}function it(t){return o(t).desaturate(100)}function ot(t,e){e=e===0?0:e||10;var r=o(t).toHsl();return r.l+=e/100,r.l=Y(r.l),o(r)}function ut(t,e){e=e===0?0:e||10;var r=o(t).toRgb();return r.r=Math.max(0,Math.min(255,r.r-Math.round(255*-(e/100)))),r.g=Math.max(0,Math.min(255,r.g-Math.round(255*-(e/100)))),r.b=Math.max(0,Math.min(255,r.b-Math.round(255*-(e/100)))),o(r)}function ft(t,e){e=e===0?0:e||10;var r=o(t).toHsl();return r.l-=e/100,r.l=Y(r.l),o(r)}function ht(t,e){var r=o(t).toHsl(),n=(r.h+e)%360;return r.h=n<0?360+n:n,o(r)}function lt(t){var e=o(t).toHsl();return e.h=(e.h+180)%360,o(e)}function D(t,e){if(isNaN(e)||e<=0)throw new Error(\"Argument to polyad must be a positive number\");for(var r=o(t).toHsl(),n=[o(t)],s=360/e,a=1;a<e;a++)n.push(o({h:(r.h+a*s)%360,s:r.s,l:r.l}));return n}function ct(t){var e=o(t).toHsl(),r=e.h;return[o(t),o({h:(r+72)%360,s:e.s,l:e.l}),o({h:(r+216)%360,s:e.s,l:e.l})]}function gt(t,e,r){e=e||6,r=r||30;var n=o(t).toHsl(),s=360/r,a=[o(t)];for(n.h=(n.h-(s*e>>1)+720)%360;--e;)n.h=(n.h+s)%360,a.push(o(n));return a}function bt(t,e){e=e||6;for(var r=o(t).toHsv(),n=r.h,s=r.s,a=r.v,i=[],f=1/e;e--;)i.push(o({h:n,s,v:a})),a=(a+f)%1;return i}o.mix=function(t,e,r){r=r===0?0:r||50;var n=o(t).toRgb(),s=o(e).toRgb(),a=r/100,i={r:(s.r-n.r)*a+n.r,g:(s.g-n.g)*a+n.g,b:(s.b-n.b)*a+n.b,a:(s.a-n.a)*a+n.a};return o(i)};o.readability=function(t,e){var r=o(t),n=o(e);return(Math.max(r.getLuminance(),n.getLuminance())+.05)/(Math.min(r.getLuminance(),n.getLuminance())+.05)};o.isReadable=function(t,e,r){var n=o.readability(t,e),s,a;switch(a=!1,s=_t(r),s.level+s.size){case\"AAsmall\":case\"AAAlarge\":a=n>=4.5;break;case\"AAlarge\":a=n>=3;break;case\"AAAsmall\":a=n>=7;break}return a};o.mostReadable=function(t,e,r){var n=null,s=0,a,i,f,h;r=r||{},i=r.includeFallbackColors,f=r.level,h=r.size;for(var m=0;m<e.length;m++)a=o.readability(t,e[m]),a>s&&(s=a,n=o(e[m]));return o.isReadable(t,n,{level:f,size:h})||!i?n:(r.includeFallbackColors=!1,o.mostReadable(t,[\"#fff\",\"#000\"],r))};var z=o.names={aliceblue:\"f0f8ff\",antiquewhite:\"faebd7\",aqua:\"0ff\",aquamarine:\"7fffd4\",azure:\"f0ffff\",beige:\"f5f5dc\",bisque:\"ffe4c4\",black:\"000\",blanchedalmond:\"ffebcd\",blue:\"00f\",blueviolet:\"8a2be2\",brown:\"a52a2a\",burlywood:\"deb887\",burntsienna:\"ea7e5d\",cadetblue:\"5f9ea0\",chartreuse:\"7fff00\",chocolate:\"d2691e\",coral:\"ff7f50\",cornflowerblue:\"6495ed\",cornsilk:\"fff8dc\",crimson:\"dc143c\",cyan:\"0ff\",darkblue:\"00008b\",darkcyan:\"008b8b\",darkgoldenrod:\"b8860b\",darkgray:\"a9a9a9\",darkgreen:\"006400\",darkgrey:\"a9a9a9\",darkkhaki:\"bdb76b\",darkmagenta:\"8b008b\",darkolivegreen:\"556b2f\",darkorange:\"ff8c00\",darkorchid:\"9932cc\",darkred:\"8b0000\",darksalmon:\"e9967a\",darkseagreen:\"8fbc8f\",darkslateblue:\"483d8b\",darkslategray:\"2f4f4f\",darkslategrey:\"2f4f4f\",darkturquoise:\"00ced1\",darkviolet:\"9400d3\",deeppink:\"ff1493\",deepskyblue:\"00bfff\",dimgray:\"696969\",dimgrey:\"696969\",dodgerblue:\"1e90ff\",firebrick:\"b22222\",floralwhite:\"fffaf0\",forestgreen:\"228b22\",fuchsia:\"f0f\",gainsboro:\"dcdcdc\",ghostwhite:\"f8f8ff\",gold:\"ffd700\",goldenrod:\"daa520\",gray:\"808080\",green:\"008000\",greenyellow:\"adff2f\",grey:\"808080\",honeydew:\"f0fff0\",hotpink:\"ff69b4\",indianred:\"cd5c5c\",indigo:\"4b0082\",ivory:\"fffff0\",khaki:\"f0e68c\",lavender:\"e6e6fa\",lavenderblush:\"fff0f5\",lawngreen:\"7cfc00\",lemonchiffon:\"fffacd\",lightblue:\"add8e6\",lightcoral:\"f08080\",lightcyan:\"e0ffff\",lightgoldenrodyellow:\"fafad2\",lightgray:\"d3d3d3\",lightgreen:\"90ee90\",lightgrey:\"d3d3d3\",lightpink:\"ffb6c1\",lightsalmon:\"ffa07a\",lightseagreen:\"20b2aa\",lightskyblue:\"87cefa\",lightslategray:\"789\",lightslategrey:\"789\",lightsteelblue:\"b0c4de\",lightyellow:\"ffffe0\",lime:\"0f0\",limegreen:\"32cd32\",linen:\"faf0e6\",magenta:\"f0f\",maroon:\"800000\",mediumaquamarine:\"66cdaa\",mediumblue:\"0000cd\",mediumorchid:\"ba55d3\",mediumpurple:\"9370db\",mediumseagreen:\"3cb371\",mediumslateblue:\"7b68ee\",mediumspringgreen:\"00fa9a\",mediumturquoise:\"48d1cc\",mediumvioletred:\"c71585\",midnightblue:\"191970\",mintcream:\"f5fffa\",mistyrose:\"ffe4e1\",moccasin:\"ffe4b5\",navajowhite:\"ffdead\",navy:\"000080\",oldlace:\"fdf5e6\",olive:\"808000\",olivedrab:\"6b8e23\",orange:\"ffa500\",orangered:\"ff4500\",orchid:\"da70d6\",palegoldenrod:\"eee8aa\",palegreen:\"98fb98\",paleturquoise:\"afeeee\",palevioletred:\"db7093\",papayawhip:\"ffefd5\",peachpuff:\"ffdab9\",peru:\"cd853f\",pink:\"ffc0cb\",plum:\"dda0dd\",powderblue:\"b0e0e6\",purple:\"800080\",rebeccapurple:\"663399\",red:\"f00\",rosybrown:\"bc8f8f\",royalblue:\"4169e1\",saddlebrown:\"8b4513\",salmon:\"fa8072\",sandybrown:\"f4a460\",seagreen:\"2e8b57\",seashell:\"fff5ee\",sienna:\"a0522d\",silver:\"c0c0c0\",skyblue:\"87ceeb\",slateblue:\"6a5acd\",slategray:\"708090\",slategrey:\"708090\",snow:\"fffafa\",springgreen:\"00ff7f\",steelblue:\"4682b4\",tan:\"d2b48c\",teal:\"008080\",thistle:\"d8bfd8\",tomato:\"ff6347\",turquoise:\"40e0d0\",violet:\"ee82ee\",wheat:\"f5deb3\",white:\"fff\",whitesmoke:\"f5f5f5\",yellow:\"ff0\",yellowgreen:\"9acd32\"},dt=o.hexNames=mt(z);function mt(t){var e={};for(var r in t)t.hasOwnProperty(r)&&(e[t[r]]=r);return e}function V(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function v(t,e){pt(t)&&(t=\"100%\");var r=vt(t);return t=Math.min(e,Math.max(0,parseFloat(t))),r&&(t=parseInt(t*e,10)/100),Math.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function Y(t){return Math.min(1,Math.max(0,t))}function R(t){return parseInt(t,16)}function pt(t){return typeof t==\"string\"&&t.indexOf(\".\")!=-1&&parseFloat(t)===1}function vt(t){return typeof t==\"string\"&&t.indexOf(\"%\")!=-1}function k(t){return t.length==1?\"0\"+t:\"\"+t}function F(t){return t<=1&&(t=t*100+\"%\"),t}function j(t){return Math.round(parseFloat(t)*255).toString(16)}function O(t){return R(t)/255}var A=function(){var t=\"[-\\\\+]?\\\\d+%?\",e=\"[-\\\\+]?\\\\d*\\\\.\\\\d+%?\",r=\"(?:\"+e+\")|(?:\"+t+\")\",n=\"[\\\\s|\\\\(]+(\"+r+\")[,|\\\\s]+(\"+r+\")[,|\\\\s]+(\"+r+\")\\\\s*\\\\)?\",s=\"[\\\\s|\\\\(]+(\"+r+\")[,|\\\\s]+(\"+r+\")[,|\\\\s]+(\"+r+\")[,|\\\\s]+(\"+r+\")\\\\s*\\\\)?\";return{CSS_UNIT:new RegExp(r),rgb:new RegExp(\"rgb\"+n),rgba:new RegExp(\"rgba\"+s),hsl:new RegExp(\"hsl\"+n),hsla:new RegExp(\"hsla\"+s),hsv:new RegExp(\"hsv\"+n),hsva:new RegExp(\"hsva\"+s),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function w(t){return!!A.CSS_UNIT.exec(t)}function yt(t){t=t.replace(J,\"\").replace(K,\"\").toLowerCase();var e=!1;if(z[t])t=z[t],e=!0;else if(t==\"transparent\")return{r:0,g:0,b:0,a:0,format:\"name\"};var r;return(r=A.rgb.exec(t))?{r:r[1],g:r[2],b:r[3]}:(r=A.rgba.exec(t))?{r:r[1],g:r[2],b:r[3],a:r[4]}:(r=A.hsl.exec(t))?{h:r[1],s:r[2],l:r[3]}:(r=A.hsla.exec(t))?{h:r[1],s:r[2],l:r[3],a:r[4]}:(r=A.hsv.exec(t))?{h:r[1],s:r[2],v:r[3]}:(r=A.hsva.exec(t))?{h:r[1],s:r[2],v:r[3],a:r[4]}:(r=A.hex8.exec(t))?{r:R(r[1]),g:R(r[2]),b:R(r[3]),a:O(r[4]),format:e?\"name\":\"hex8\"}:(r=A.hex6.exec(t))?{r:R(r[1]),g:R(r[2]),b:R(r[3]),format:e?\"name\":\"hex\"}:(r=A.hex4.exec(t))?{r:R(r[1]+\"\"+r[1]),g:R(r[2]+\"\"+r[2]),b:R(r[3]+\"\"+r[3]),a:O(r[4]+\"\"+r[4]),format:e?\"name\":\"hex8\"}:(r=A.hex3.exec(t))?{r:R(r[1]+\"\"+r[1]),g:R(r[2]+\"\"+r[2]),b:R(r[3]+\"\"+r[3]),format:e?\"name\":\"hex\"}:!1}function _t(t){var e,r;return t=t||{level:\"AA\",size:\"small\"},e=(t.level||\"AA\").toUpperCase(),r=(t.size||\"small\").toLowerCase(),e!==\"AA\"&&e!==\"AAA\"&&(e=\"AA\"),r!==\"small\"&&r!==\"large\"&&(r=\"small\"),{level:e,size:r}}function U(t=\"AA\",e=\"auto\",r=\"graphics\"){if(t===\"AAA\")switch(e){case\"large-text\":return 4.5;case\"normal-text\":return 7;case\"graphics\":return 3;case\"auto\":return r===\"text\"?7:3;default:return r===\"text\"?7:3}else switch(e){case\"large-text\":return 3;case\"normal-text\":return 4.5;case\"graphics\":return 3;case\"auto\":return r===\"text\"?4.5:3;default:return r===\"text\"?4.5:3}}var W=(t,e,r=1)=>{let n=o(t),s=o(e);s.setAlpha(r);let a=s;return r<1&&(a=o.mix(n.toRgbString(),s.toRgbString(),r*100)),o.readability(n,a)};var X=(t,e)=>Math.atan2(e[1]-t[1],e[0]-t[0]),xt=(t,e)=>{let r=e-t;for(;r<=-Math.PI;)r+=2*Math.PI;for(;r>Math.PI;)r-=2*Math.PI;return Math.abs(r)},Mt=(t,e,r)=>{let[n,s]=t,[a,i]=e,[f,h]=r,m=Math.pow(f-a,2)+Math.pow(h-i,2);if(m===0)return Math.sqrt(Math.pow(n-a,2)+Math.pow(s-i,2));let S=Math.max(0,Math.min(1,((n-a)*(f-a)+(s-i)*(h-i))/m)),_=a+S*(f-a),M=i+S*(h-i);return Math.sqrt(Math.pow(n-_,2)+Math.pow(s-M,2))},L=(t,e)=>{if(t.length<=2)return t;let r=0,n=0,s=t[0],a=t[t.length-1];for(let i=1;i<t.length-1;i++){let f=Mt(t[i],s,a);f>r&&(r=f,n=i)}if(r>e){let i=L(t.slice(0,n+1),e),f=L(t.slice(n),e);return[...i.slice(0,-1),...f]}else return[s,a]},St=t=>{if(t.length===0)return 1;let e=t[0][0],r=t[0][0],n=t[0][1],s=t[0][1];for(let a=1;a<t.length;a++)e=Math.min(e,t[a][0]),r=Math.max(r,t[a][0]),n=Math.min(n,t[a][1]),s=Math.max(s,t[a][1]);return Math.max(r-e,s-n)||1},Ct=(t,e,r,n=Math.PI/2)=>{if(t.length<2)return[];try{r=Math.round(r),e=Math.round(e);let a=St(t)*.02,i=L(t,a),f=5,h=1;if(i.length>0){let g=i[0];if(g[0]<=h&&(g[0]=0),g[1]<=f?g[1]=0:g[1]>=e-f&&(g[1]=e),i.length>1){let b=i.length-1,l=i[b];l[1]<=f?l[1]=0:l[1]>=e-f&&(l[1]=e)}i=i.filter((b,l,C)=>l===0||b[0]!==C[l-1][0]||b[1]!==C[l-1][1])}if(i.length<2)return[];let m=new Array(i.length).fill(!1);if(i.length>=3){let g=X(i[0],i[1]);for(let b=1;b<i.length-1;b++){let l=X(i[b],i[b+1]);xt(g,l)>n&&(m[b]=!0),g=l}}let S=new Array(i.length);if(i.length>=2){let g=i[1][0]-i[0][0],b=i[1][1]-i[0][1],l=Math.sqrt(g*g+b*b);S[0]=l?[g/l,b/l]:[0,0];let C=i.length-1,H=i[C][0]-i[C-1][0],B=i[C][1]-i[C-1][1],I=Math.sqrt(H*H+B*B);S[C]=I?[H/I,B/I]:[0,0];for(let u=1;u<C;u++){if(m[u])continue;let y=i[u-1],p=i[u+1],c=p[0]-y[0],d=p[1]-y[1],x=Math.sqrt(c*c+d*d);S[u]=x?[c/x,d/x]:[0,0]}}else return[];let _=[],M=.75;for(let g=0;g<i.length-1;g++){let b=i[g],l=i[g+1],C=m[g]||b[1]<=f||b[1]>=e-f||b[0]<=h||b[0]>=r-h,H=m[g+1]||l[1]<=f||l[1]>=e-f||l[0]<=h||l[0]>=r-h,B=[...b],I=[...l];if(!C){let u=S[g],y=Math.sqrt(Math.pow(l[0]-b[0],2)+Math.pow(l[1]-b[1],2));B=[b[0]+u[0]*y*M*.5,b[1]+u[1]*y*M*.5]}if(!H){let u=S[g+1],y=Math.sqrt(Math.pow(l[0]-b[0],2)+Math.pow(l[1]-b[1],2));I=[l[0]-u[0]*y*M*.5,l[1]-u[1]*y*M*.5]}_.push({start:b,cp1:B,cp2:I,end:l})}return _}catch{let s=[];if(t.length>=2)for(let a=0;a<t.length-1;a++)s.push({start:t[a],cp1:t[a],cp2:t[a+1],end:t[a+1]});return s}},Rt=(t,e,r,n,s,a,i,f,h)=>{t=Math.round(t),e=Math.round(e),r=Math.round(r),s=Number(s.toFixed(2));let m=U(a,i,f),S={lowerBoundary:null,upperBoundary:null,threshold:m};if(t<=0||e<=0)return S;let _=h===\"hsl\",M=[],g=[],b=2,l=!0;for(let u=0;u<=t;u+=b){let y=[],p=null;for(let c=0;c<=e;c++){let d=u/t,x=1-c/e,T=null;if(_?T=o({h:r,s:d,l:x,a:s}):T=o({h:r,s:d,v:x,a:s}),!T||!T.isValid())continue;let Z=T.toRgb();(d>0||x>0)&&(l=!1);let P=W(n,Z,s)>=m;P&&!p?p={startY:c,endY:c}:P&&p?p.endY=c:!P&&p&&(y.push({...p}),p=null)}if(p&&y.push({...p}),y.length===1){let c=y[0];c.startY===0?M.push([u,c.endY]):c.endY===e?g.push([u,c.startY]):(g.push([u,c.startY]),M.push([u,c.endY]))}else if(y.length>=2){let c=y[0],d=y[y.length-1];c.startY===0?M.push([u,c.endY]):(g.push([u,c.startY]),M.push([u,c.endY])),d.endY===e?(c.startY!==0||d.startY!==c.startY)&&g.push([u,d.startY]):d!==c&&(d.startY!==c.startY&&g.push([u,d.startY]),d.endY!==c.endY&&M.push([u,d.endY]))}}let C=(u,y)=>{if(u.length<2){if(l&&y){let d=[[0,e],[t,e]],x=[{start:d[0],cp1:d[0],cp2:d[1],end:d[1]}];return{points:d,simplifiedPoints:d,bezierSegments:x}}return null}u[0][0]>0?u.unshift([0,u[0][1]]):u[0][0]=0,u[u.length-1][0]<t?u.push([t,u[u.length-1][1]]):u[u.length-1][0]=t;let p=u.filter((d,x,T)=>x===0||d[0]!==T[x-1][0]||d[1]!==T[x-1][1]);if(p.length<2)return null;let c=Ct(p,e,t);if(!c||c.length===0){if(p.length>=2){let d=[];for(let x=0;x<p.length-1;x++)d.push({start:p[x],cp1:p[x],cp2:p[x+1],end:p[x+1]});return{points:u,simplifiedPoints:p,bezierSegments:d}}return null}return{points:u,simplifiedPoints:p,bezierSegments:c}},H=C(M,!0),B=C(g,!1);if(s<.01&&!H&&!B){let u=[[0,e],[t,e]];return{lowerBoundary:{points:u,simplifiedPoints:u,bezierSegments:[{start:u[0],cp1:u[0],cp2:u[1],end:u[1]}]},upperBoundary:null,threshold:m}}if(!H&&!B){let u=[[0,e],[t,e]];return{lowerBoundary:{points:u,simplifiedPoints:u,bezierSegments:[{start:u[0],cp1:u[0],cp2:u[1],end:u[1]}]},upperBoundary:null,threshold:m}}return{lowerBoundary:H,upperBoundary:B,threshold:m}};self.onmessage=t=>{let{id:e,params:r}=t.data;if(!r){self.postMessage({id:e,error:\"Received message with undefined params\"});return}let{width:n,height:s,hue:a,backgroundColor:i,foregroundAlpha:f,level:h,category:m,selectedElementType:S,colorSpace:_}=r;try{let M=Rt(n,s,a,i,f,h,m,S,_);self.postMessage({id:e,result:M})}catch(M){self.postMessage({id:e,error:M instanceof Error?M.message:String(M)})}};})();\n\n} catch (e) {\n  self.postMessage({ id: -1, error: 'Worker init error: ' + (e.message || e) });\n}\n\n// 发送初始化完成消息\nself.postMessage({ id: 0, status: 'ready' });\n";

// 创建 Worker 的函数
export const createBoundaryWorker = (): Worker | null => {
  if (typeof window === "undefined") {
    return null;
  }

  try {
    const blob = new Blob([BOUNDARY_WORKER_CODE], { type: "application/javascript" });
    const url = URL.createObjectURL(blob);
    const worker = new Worker(url);

    // 延迟清理 URL，确保 Worker 有足够时间加载
    setTimeout(() => {
      URL.revokeObjectURL(url);
    }, 1000);

    return worker;
  } catch {
    return null;
  }
};
